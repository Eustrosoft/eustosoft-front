<!--
  ~ Copyright (c) 2024. IdrisovII & EustroSoft.org
  ~
  ~ This file is part of eustrosoft-front project.
  ~ See the LICENSE file at the project root for licensing information.
  -->
<ng-container *ngIf="{ tests: tests$ | async } as vm">
  <ng-container *ngIf="!vm.tests?.results && !vm.tests?.isLoading">
    <h1>Test results will be here. Run tests using the button</h1>
  </ng-container>
  <ng-container *ngIf="vm.tests?.isLoading && !vm.tests?.isError">
    <div class="flex flex-column align-items-center">
      <h1>Tests are being executed...</h1>
      <eustrosoft-front-preloader
        class="flex justify-content-center"
      ></eustrosoft-front-preloader>
    </div>
  </ng-container>
  <!--  <ng-container *ngIf="vm.tests?.isError">-->
  <!--    <p>Error</p>-->
  <!--  </ng-container>-->
  <ng-container *ngIf="vm.tests?.results as results">
    {{ results | json }}
    <div class="flex g-3">
      <button
        mat-stroked-button
        color="primary"
        type="button"
        (click)="accordion.openAll()"
      >
        Expand All
      </button>
      <button
        mat-stroked-button
        color="primary"
        type="button"
        (click)="accordion.closeAll()"
      >
        Collapse All
      </button>
    </div>
    <mat-accordion [multi]="true">
      <ng-container *ngFor="let test of results; let index = index">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{ test.title }}
            </mat-panel-title>
            <mat-panel-description>
              <mat-chip-set [ngSwitch]="test.result" class="me-2">
                <mat-chip
                  *ngSwitchCase="TestResult.OK"
                  (click)="$event.stopPropagation()"
                  highlighted
                >
                  OK
                </mat-chip>
                <mat-chip
                  *ngSwitchCase="TestResult.FAIL"
                  (click)="$event.stopPropagation()"
                  color="warn"
                  highlighted
                >
                  FAIL
                </mat-chip>
                <mat-chip
                  *ngSwitchCase="TestResult.CANCELED"
                  (click)="$event.stopPropagation()"
                  highlighted
                >
                  CANCELED
                </mat-chip>
              </mat-chip-set>

              <span>{{ test.description }}</span>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <ng-container>
            <div
              class="flex flex-column"
              *ngIf="test.errorText || test.responseStatus"
            >
              <span *ngIf="test.errorText">
                Test Case Error:
                {{ test.errorText }}
              </span>
              <span *ngIf="test.responseStatus">
                Response Status: {{ test.responseStatus }}
              </span>
            </div>
            <pre *ngIf="showResponses$ | async" class="overflow-auto">
              {{ test.response | json }}
            </pre>
          </ng-container>
        </mat-expansion-panel>
      </ng-container>
    </mat-accordion>
  </ng-container>
</ng-container>
